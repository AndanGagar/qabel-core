apply plugin: 'java'

sourceCompatibility = 1.8
version = '0.1'
group = 'de.qabel.box'

ext.sharedManifest = manifest {
    attributes 'Implementation-Version': version
    attributes 'Project': 'Qabel Core'
    attributes 'Component': 'Box'
    attributes 'Built-From-Revision': "git rev-parse HEAD".execute().text.trim()
}

jar {
    manifest = project.manifest {
        from sharedManifest
        attributes 'Implementation-Title': 'Qabel Core - Box Component'
    }
}

repositories {
	mavenCentral()
}

dependencies {
	testCompile group: 'junit', name: 'junit', version: '4.+'
	testCompile group: 'org.meanbean', name: 'meanbean', version: '2.+'
	compile project(':core')
}

tasks.withType(Test) {
	def platform = "${System.properties['os.name'].toLowerCase()}_${System.properties['os.arch']}"
	systemProperty "java.library.path", "../core/build/binaries/curve25519SharedLibrary/$platform/"
}

sourceSets {
	main {
		resources.srcDirs += ['src/resources/config/']
	}
	test {
		resources.srcDirs += ['src/resources/config/']
	}
}

task testJar(type: Jar) {
    from(sourceSets.test.output) {
        include "**"
    }
    baseName = 'box-test-'
    manifest {
        from sharedManifest
        attributes 'Implementation-Title': 'Qabel Core - Box Component - Test artifact'
    }
}

jar.manifest.writeTo("$buildDir/manifest.mf")
testJar.manifest.writeTo("$buildDir/test-manifest.mf")
